@model WAGestPerso.Models.Utilisateur
@{
   ViewBag.Title = "AjoutUtilisateur";
   Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Ajouter un utilisateur</h2>

<div>
   <form id="formUtilisateurs" name="formUtilisateurs" action="" method="post" enctype="multipart/form-data">
      <div class="row">
         <div class="col-xs-12 col-sm-6">
            <div class="form-group">
               <label>Nom</label>
               <input type="text" class="form-control" id="nom_utilisateur" name="nom" value="@(Model!=null?Model.nom:"")" required />
            </div>
            <div class="form-group">
               <label>email</label>
               <input type="email" class="form-control" id="email_utilisateur" name="email" value="@(Model!=null?Model.email:"")" required />
            </div>
         </div>


         <div class="col-xs-12 col-sm-4">
            <div class="form-group">
               <label>Mot de passe</label>
               <input type="password" class="form-control" id="mdp" name="mdp" value="@(Model!=null?Model.mdp:"")" required />
            </div>
            <div class="form-group">
               <label>Role</label>       <br />
               <select id="Role" name="role">
                  <option value="1" @(Model!=null? Model.role==1? "selected":"":"")>Administrateur</option>
                  <option value="2" @(Model!=null? Model.role==2? "selected":"":"")>Utilisateur</option>
                  <option value="3" @(Model!=null? Model.role==3? "selected":"":"")>Visiteur</option>
               </select>
            </div>

            <div class="form-group">
               <label>Photo</label>
               <input type="file" id="PHOTO" name="photo" class="form-control" value="@(Model!=null?Model.photo:"")"/>
            </div>

         </div>
      </div>
      <div class="row">
         <input type="submit" id="submitTache" name="submitTache" value="Enregistrer" class="btn btn-primary" 
                @(int.Parse(((FormsIdentity)User.Identity).Ticket.UserData) == 3 ? " disabled":"") />
      </div>
      <hr />
   </form>
   <div class="table-responsive">
      <table class="table table-bordered">
         <tr>
            <th>Utilisateur</th>
            <th>Photo</th>
            <th>EMail</th>
            <th>Role</th>
         </tr>

         @foreach (var data in ViewBag.listeUtilisateurs)
         {
      <tr>
         <td>@data.nom</td>
         @if (data.photo == null) { data.photo = "user.jpg"; }
         <td><img src="~/Images/@data.photo" width="100" height="80" /></td>
         <td>@data.email</td>
         <td>@(data.role == 1 ? "administrateur" : data.role == 2 ? "Utilisateur" : "Visiteur") </td>

         @if (int.Parse(((FormsIdentity)User.Identity).Ticket.UserData) == 3)
         {
         <td><a disabled class="btn btn-warning btn-xs"><span class="glyphicon glyphicon-edit"></span>Modifier</a> </td>

         }else
         {
         <td><a href="~/Utilisateurs/ModifierUtilisateur/@data.id" class="btn btn-warning btn-xs"><span class="glyphicon glyphicon-edit"></span>Modifier</a> </td>

         }

         @if (data.Taches.Count == 0)
         {
            if (int.Parse(((FormsIdentity)User.Identity).Ticket.UserData) == 3)
            {
               <td>
                  <a disabled 
                     onclick="return confirm('Voulez-vous vraiment supprimer l\'utilisateur : @data.nom')"
                     class="btn btn-danger btn-xs"><span class="glyphicon glyphicon-remove"></span>Supprimer</a>
               </td>
            }
            else
            {
               <td>
                  <a  href="~/Utilisateurs/SupprimerUtilisateur/@data.id"
                     onclick="return confirm('Voulez-vous vraiment supprimer l\'utilisateur : @data.nom')"
                     class="btn btn-danger btn-xs"><span class="glyphicon glyphicon-remove" disabled></span>Supprimer</a>
               </td>
            }
         }
      </tr>

         }

      </table>
   </div>

</div>

